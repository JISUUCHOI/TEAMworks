<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mailMapper">
  	
  	<resultMap type="MailInfo" id="mailInfoResultSet">
  		<id column="em_info_no" property="emailInfoNo"/>
  		<result column="em_imap" property="emIimap"/>
  		<result column="em_imap_port" property="emIimapport"/>
  		<result column="em_smtp" property="emIsmtp"/>
  		<result column="em_smtp_port" property="emIsmtpport"/>
  		<result column="email_user" property="emIuserId"/>
  		<result column="email_pwd" property="emIuserPwd"/>
  		<result column="entry_date" property="entryDate"/>
  		<result column="emp_id" property="empId"/>
  		<result column="emp_name" property="empName"/>
  		<result column="status" property="status"/>
  	</resultMap>
  	
  		<resultMap type="MailDTO" id="mailDtoResultSet">
  		<id column="email_no" property="emailNo"/>
  		<result column="email_title" property="mailTitle"/>
  		<result column="email_content" property="mailContent"/>
  		<result column="create_date" property="createDate"/>
  		<result column="email_status" property="emailStatus"/>
  		<result column="em_info_no" property="emInfoNo"/>
  		<result column="emp_id" property="sender"/>
  		<result column="emp_id2" property="recipients"/>
  		<result column="delete_status" property="deleteStatus"/>
  		<result column="read_status" property="readStatus"/>
  		<result column="emp_name" property="senderName"/>
  		<result column="emp_email" property="senderEmail"/>
  		<result column="ref_emp" property="refRecipients"/>
  		<result column="eatype" property="refType"/>
  		<result column="files" property="files"/>
  	</resultMap>
  	
 	<select id="selectInboxListCount" parameterType="string" resultType="_int">
 		SELECT COUNT(*)
		  FROM V_EMAIL_LIST
		 WHERE EMP_ID2=#{empId} OR REF_EMP= #{empId} AND EMAIL_STATUS='Y'
 	</select>
 	
 	<select id="selectInboxList" parameterType="string" resultMap="mailDtoResultSet">
 		SELECT *
		  FROM V_EMAIL_LIST
		 WHERE EMP_ID2=#{empId} OR REF_EMP= #{empId} AND EMAIL_STATUS='Y'
		 ORDER BY EMAIL_NO DESC
 	</select>
 	
 	<select id="searchReadListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int">
 		select count(*)
		from (select * from v_email_list
		      where EMP_ID2= #{empId} OR REF_EMP=#{empId} and email_status='Y')
		where read_status = #{readStatus}
 	</select>
 	<select id="searchReadList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
		from (select * from v_email_list
		      where EMP_ID2= #{empId} OR REF_EMP=#{empId} and email_status='Y')
		where read_status = #{readStatus}
		order by email_no desc
 	</select>
 	
 	<select id="searchKeyListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int">
 		select count(*)
		from (select * from v_email_list
		      where EMP_ID2= #{empId} OR REF_EMP=#{empId} and email_status='Y')
		<where>
			<if test="sender != null">
				emp_name like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				email_content like '%'|| #{content} ||'%'
			</if>
		</where>
 	</select>
 	
 	<select id="searchKeyList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
		from (select * from v_email_list
		      where EMP_ID2= #{empId} OR REF_EMP=#{empId} and email_status='Y')
		<where>
			<if test="sender != null">
				emp_name like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				email_content like '%'|| #{content} ||'%'
			</if>
		</where>
		order by email_no desc
 	</select>
 	
 	<select id="searchListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int" >
 		select count(*)
		from (select * from v_email_list
		      where EMP_ID2= #{empId} OR REF_EMP=#{empId} and email_status='Y')
		where read_status = ${readStatus}
			<if test="sender != null">
				and emp_name like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
 	</select>
 	
 	 	<select id="searchList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
		from (select * from v_email_list
		      where EMP_ID2= #{empId} OR REF_EMP=#{empId} and email_status='Y')
		where read_status = ${readStatus}
			<if test="sender != null">
				and emp_name like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
		order by email_no desc
 	</select>
</mapper>
