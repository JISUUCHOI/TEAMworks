<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mailMapper">
  	
  	<resultMap type="MailInfo" id="mailInfoResultSet">
  		<id column="em_info_no" property="emailInfoNo"/>
  		<result column="em_imap" property="emIimap"/>
  		<result column="em_imap_port" property="emIimapport"/>
  		<result column="em_smtp" property="emIsmtp"/>
  		<result column="em_smtp_port" property="emIsmtpport"/>
  		<result column="email_user" property="emIuserId"/>
  		<result column="email_pwd" property="emIuserPwd"/>
  		<result column="entry_date" property="entryDate"/>
  		<result column="emp_id" property="empId"/>
  		<result column="emp_name" property="empName"/>
  		<result column="status" property="status"/>
  	</resultMap>
  	
  		<resultMap type="MailDTO" id="mailDtoResultSet">
  		<id column="email_no" property="emailNo"/>
  		<result column="email_title" property="mailTitle"/>
  		<result column="email_content" property="mailContent"/>
  		<result column="create_date" property="createDate"/>
  		<result column="em_info_no" property="emInfoNo"/>
  		<result column="sender" property="sender"/>
  		<result column="sendername" property="senderName"/>
  		<result column="senderemail" property="senderEmail"/>
  		<result column="files" property="files"/>
  		<result column="receiver" property="recipients"/>
  		<result column="receivername" property="recipientsName"/>
  		<result column="receiveremail" property="recipientsEmail"/>
  		<result column="read_status" property="readStatus"/>
  		<result column="delete_status" property="deleteStatus"/>
  		<result column="status" property="emailStatus"/>
  		<result column="eatype" property="refType"/>
  	</resultMap>
  	
 	<select id="selectInboxListCount" parameterType="string" resultType="_int">
 		select count(*)
		  from v_email_list 
		 where receiver =#{empId} and status='Y'
 	</select>
 	
 	<select id="selectInboxList" parameterType="string" resultMap="mailDtoResultSet">
 		select *
          from v_email_list 
         where receiver =#{empId} and status='Y'
         order by email_no desc
 	</select>
 	
 	<select id="searchReadListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int">
 		select count(*)
          from v_email_list 
         where receiver =#{empId} and status='Y' and read_status= #{readStatus}
 	</select>
 	<select id="searchReadList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
          from v_email_list 
         where receiver =#{empId} and status='Y' and read_status= #{readStatus}
		 order by email_no desc
 	</select>
 	
 	<select id="searchKeyListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int">
 		select count(*)
		  from v_email_list 
         where receiver =#{empId} and status='Y'
			<if test="sender != null">
				and sendername like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
 	</select>
 	
 	<select id="searchKeyList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
		  from v_email_list 
         where receiver =#{empId} and status='Y'
			<if test="sender != null">
				and sendername like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
		order by email_no desc
 	</select>
 	
 	<select id="searchListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int" >
 		select count(*)
 		 from v_email_list 
         where receiver =#{empId} and status='Y'
		        and read_status = #{readStatus}
			<if test="sender != null">
				and sendername like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
 	</select>
 	
 	 <select id="searchList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
		 from v_email_list 
         where receiver =#{empId} and status='Y'
		        and read_status = #{readStatus}
			<if test="sender != null">
				and sendername like '%'|| #{sender} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
		order by email_no desc
 	</select>
 	<select id="selectOutboxListCount" parameterType="string" resultType="_int">
 		select count(*) 
		  from email 
		 where sender=#{empId}
 	</select>
 	<select id="selectOutboxList" parameterType="string" resultMap="mailDtoResultSet">
 		select *
	      from v_email_list
		 where sender=#{empId} and eatype='T'
		 order by email_no desc
 	</select>
 	
 	<select id="searchOutboxListCount" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultType="_int">
 		select count(*) 
		  from v_email_list
		 where sender=#{empId} and eatype='T'
			<if test="recipients != null">
				and receivername like '%'|| #{recipients} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
 	</select>
 	<select id="searchOutboxList" parameterType="com.kh.teamworks.mail.model.vo.SearchMailCondition" resultMap="mailDtoResultSet">
 		select *
		  from v_email_list
		 where sender=#{empId} and eatype='T'
			<if test="recipients != null">
				and receivername like '%'|| #{recipients} ||'%'
			</if>
			<if test="title != null">
				and email_title like '%'|| #{title} ||'%'
			</if>
			<if test="content != null">
				and email_content like '%'|| #{content} ||'%'
			</if>
		order by email_no desc
 	</select>
 	
 	<update id="changeReadStatus" parameterType="Mail" >
 			update email_address
		       set read_status='Y' 
             where receiver =#{recipients} and email_no=#{emailNo}
 	</update>
 	
 	<update id="deleteMail" parameterType="Mail">
 		update email_address
 		   set status='N' 
 		 where receiver =#{recipients} and email_no=#{emailNo}
 	</update>
</mapper>
